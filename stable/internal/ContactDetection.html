<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Contact Detection · Modia3D</title><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.044/juliamono.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.11/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../index.html">Modia3D</a></span></div><form class="docs-search" action="../search.html"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../index.html">Home</a></li><li><span class="tocitem">Tutorial</span><ul><li><a class="tocitem" href="../tutorial/Tutorial.html">Modia3D Tutorial</a></li><li><a class="tocitem" href="../tutorial/GettingStarted.html">Getting Started</a></li><li><a class="tocitem" href="../tutorial/HierarchicalModels.html">Hierarchical models</a></li><li><a class="tocitem" href="../tutorial/RecursiveModels.html">Recursive models</a></li><li><a class="tocitem" href="../tutorial/CollisionHandling.html">Collision Handling</a></li></ul></li><li><span class="tocitem">Components</span><ul><li><a class="tocitem" href="../Components/Object3D.html">Object3D</a></li><li><a class="tocitem" href="../Components/Shapes.html">Shapes</a></li><li><a class="tocitem" href="../Components/Joints.html">Joints</a></li><li><a class="tocitem" href="../Components/Materials.html">Materials</a></li><li><a class="tocitem" href="../Components/GravityField.html">Gravity Field</a></li><li><a class="tocitem" href="../Components/ForceElements.html">Force Elements</a></li></ul></li><li><a class="tocitem" href="../Functions.html">Functions</a></li><li><span class="tocitem">Internal</span><ul><li><a class="tocitem" href="Profiling.html">Profiling</a></li><li><a class="tocitem" href="DynamicDispatch.html">Dynamic Dispatch</a></li><li class="is-active"><a class="tocitem" href="ContactDetection.html">Contact Detection</a><ul class="internal"><li><a class="tocitem" href="#Zero-crossing-functions"><span>Zero crossing functions</span></a></li><li><a class="tocitem" href="#Collision-handling-types"><span>Collision handling types</span></a></li><li><a class="tocitem" href="#Literature"><span>Literature</span></a></li></ul></li><li><a class="tocitem" href="ContactForceLaw.html">Contact Force Law</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Internal</a></li><li class="is-active"><a href="ContactDetection.html">Contact Detection</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href="ContactDetection.html">Contact Detection</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/ModiaSim/Modia3D.jl/blob/main/docs/src/internal/ContactDetection.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Contact-Detection"><a class="docs-heading-anchor" href="#Contact-Detection">Contact Detection</a><a id="Contact-Detection-1"></a><a class="docs-heading-anchor-permalink" href="#Contact-Detection" title="Permalink"></a></h1><p>This section is based on <sup class="footnote-reference"><a id="citeref-1" href="#footnote-1">[1]</a></sup> with some minor improvements.</p><p>The following goals shall be achieved:</p><ol><li>Whenever two objects start to penetrate, an event shall be triggered in order that integration methods with step-size control are simulating efficiencly (at the start of the contact, contact forces and torques with non-zero values are typically introduced leading to strong discontinuous changes of the equations).</li><li>When two objects start to penetrate, the normal contact velocity <span>$\dot{\delta}^-$</span> needs to be stored, because used in the <a href="ContactForceLaw.html">contact force law</a>.</li><li>Whenever two penetrating objects are not penetrating any more, again an event shall be triggered.</li></ol><p>Modia3D uses <a href="https://github.com/SciML/DifferentialEquations.jl">DifferentialEquations.jl</a> integrators to solve the equations. These integrators trigger an event when a <strong>zero crossing function</strong> crosses zero. Hereby, the option <code>DifferentialEquations.SciMLBase.RightRootFind</code> is used, that is, an event is triggered when the zero crossing function is either identical to zero or has an opposite sign. At an event restart it is required that the <strong>zero crossing functions are not identical to zero</strong>, since otherwise a zero crossing cannot be detected.</p><h2 id="Zero-crossing-functions"><a class="docs-heading-anchor" href="#Zero-crossing-functions">Zero crossing functions</a><a id="Zero-crossing-functions-1"></a><a class="docs-heading-anchor-permalink" href="#Zero-crossing-functions" title="Permalink"></a></h2><p>The distance between two objects computed either in the narrow phase or in an approximate way in the broad phase (= distance between Axis Aligned Bounding Boxes) is called <code>distanceOrg</code>. If <code>distanceOrg &lt; 0</code>, then the two objects are penetrating each other.</p><p>Modia3D uses the dictionary <code>contactDict</code> to keep track of the contact situation. Every pair of objects is identified by a unique Integer value called <em>PairID</em> that is used as key in <code>conctactDict</code>. A dictionary value is an instance of <a href="ContactDetection.html#Modia3D.Composition.ContactPair"><code>Modia3D.ContactPair</code></a></p><p>At an <strong>event instant</strong> (including initialization), dictionary <code>contactDict</code> is emptied and all object pairs are stored newly in <code>contactDict</code> that have <code>distanceOrg &lt;= 0</code>, so are either touching or penetrating.</p><p>During <strong>continuous integration</strong>, two zero crossing functions are used:</p><ul><li><span>$z_1(t)$</span>: The maximum of <code>distanceOrg</code> <span>$- 10^{-16}$</span> of all object pairs that are in <code>contactDict</code>. <span>$z_1$</span> monitors if an object pair that has been in contact, looses contact. Since <code>distanceOrg</code> values in <code>contactDict</code> are in the order of <span>$10^{-3} .. 10^{-6} ~m$</span> and <code>eps(Float64)</code> <span>$\approx 10^{-16}$</span>, a hysteresis epsilon must be larger as <span>$10^{-19} .. 10^{-24}$</span>. Actually, a hysteresis epsilon of <span>$10^{-16}$</span> is used. Note, that in <code>contactDict</code> all <code>distanceOrg</code> values are zero or negative at event restart. It is therefore guaranteed that <span>$z_1 \le - 10^{-16}$</span> at event restart (when no contact pair is present, a dummy value is used).</li></ul><ul><li><span>$z_2(t)$</span>: The minimum <code>distanceOrg</code> of all object pairs that are <strong>not</strong> in <code>contactDict</code>. <span>$z_2$</span> monitors if two objects that have not been in contact to each other and start to penetrate each other. At an event restart (including the start of the integration after the initialization), it is guaranteed that all <code>distanceOrg</code> not in <code>contactDict</code> are positive (otherwise, they would be in <code>contactDict</code>). Therefore, it is guaranteed that <span>$z_2 &gt; 0$</span> at event restart (without a hysteresis epsilon).</li></ul><p>The distance between two objects is only computed up to a certain precision. Therefore, <code>distanceOrg</code> might be nearly zero but still positive, if two objects are placed initially in touching position. For this reason the actually used distance is <code>distanceOrg - 1e-16</code>, in order that the probability is larger that objects initially in touching position are treated to be in contact initially.</p><p>To summarize, the following equations are actually used:</p><pre><code class="nohighlight hljs">distance = distanceOrg - 1e-16
contact  = isEvent ? distance &lt;= 0 : &lt;contact from previous event&gt;
z[1]     = max(&lt;distance that has contact=true&gt;) - 1e-16
z[2]     = min(&lt;distance that has contact=false&gt;)</code></pre><p>Typically, the <code>simulate!(..., log=true, ...)</code> produces the following output (here for a sphere boucing on ground):</p><pre><code class="nohighlight hljs"> State event (zero-crossing) at time = 2.3924142776549155 s (due to z[2])
   distance(ground,sphere) = -3.815173674537923e-18 became &lt;= 0
       contact normal = [0.0, 1.0, 0.0], contact position = [0.0, -0.1, 0.0], c_res = 1.1e11 d_res = 47.5
   restart = Restart

State event (zero-crossing) at time = 2.3924413895015424 s (due to z[1])
   distance(ground,sphere) = 1.0362163563391329e-16 became &gt; 0
   restart = Restart</code></pre><p>Whenever the integrator requires the values of the zero crossing functions, the values of <span>$z_1, z_2$</span> are newly computed. At all other time instants (e.g. communication points), only the distances of the object pairs are computed that are in dictionary <code>contactDict</code>, because these distances are used to compute the contact forces and torques. Distances of object pairs that are not in contact to each other are not computed at these time instants.</p><p>Whenever contact starts newly for an object pair, the normal contact velocity <span>$\dot{\delta}^-$</span> needs to be stored, since needed from the <a href="ContactForceLaw.html">elastic response calculation</a>. When a contact pair was already in contact at an event, it is necessary to utilize <span>$\dot{\delta}^-$</span> from the previous event also at the actual event. In order that these two requirements are fulfilled, a second dictionary <code>lastContactDict</code> is used: Once <code>contactDict</code> is constructed at an event, a copy is stored in <code>lastContactDict</code>. At the next event, a new <code>contactDict</code> is constructed. Whenever an object pair is included in <code>contactDict</code> that is also present in <code>lastContactDict</code>, then the normal contact velocity <span>$\dot{\delta}^-$</span> stored in <code>lastContactDict</code> is utilized.</p><p>Note, in <code>scene.options.contactDetection</code> (file <code>Modia3D/src/contactDetection/ContactDectionMPR_handler.jl</code>) information about the contact situation is stored in an instance of <a href="ContactDetection.html#Modia3D.Composition.ContactDetectionMPR_handler"><code>Modia3D.ContactDetectionMPR_handler</code></a>.</p><h2 id="Collision-handling-types"><a class="docs-heading-anchor" href="#Collision-handling-types">Collision handling types</a><a id="Collision-handling-types-1"></a><a class="docs-heading-anchor-permalink" href="#Collision-handling-types" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-binding" id="Modia3D.Composition.ContactPair" href="#Modia3D.Composition.ContactPair"><code>Modia3D.Composition.ContactPair</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">ContactPair(contactPointA, contactPointB,
    contactNormal, objA, objB,
    distanceWithHysteresis, supportPointsDefined,
    support1A, support2A, support3A,
    support1B, support2B, support3B)</code></pre><p>Generate a new <code>ContactPair</code> object of two objects that have <code>contact = true</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ModiaSim/Modia3D.jl/blob/1db3c367feb9ea97e407aedcab1efeaceb698da1/src/contactDetection/ContactDetectionMPR/ContactDetectionMPR_handler.jl#L14-L22">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="Modia3D.Composition.ContactDetectionMPR_handler" href="#Modia3D.Composition.ContactDetectionMPR_handler"><code>Modia3D.Composition.ContactDetectionMPR_handler</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">handler = ContactDetectionMPR_handler(;tol_rel = 1e-7, niter_max=100)</code></pre><p>Generate a new contact handler for usage of the MPR algorithm The handler instance contains all information about the contact situation.</p><p><strong>Arguments</strong></p><ul><li><code>tol_rel</code>: Relative tolerance to compute the contact point (&gt; 0.0)</li><li><code>niter_max</code>: Maximum number of iterations of the MPR algorithm. If this number is reached,              an error occurs (&gt; 0).</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ModiaSim/Modia3D.jl/blob/1db3c367feb9ea97e407aedcab1efeaceb698da1/src/contactDetection/ContactDetectionMPR/ContactDetectionMPR_handler.jl#L77-L89">source</a></section></article><h2 id="Literature"><a class="docs-heading-anchor" href="#Literature">Literature</a><a id="Literature-1"></a><a class="docs-heading-anchor-permalink" href="#Literature" title="Permalink"></a></h2><section class="footnotes is-size-7"><ul><li class="footnote" id="footnote-1"><a class="tag is-link" href="#citeref-1">1</a>Andrea Neumayr, Martin Otter (2019):   <a href="https://doi.org/10.1145/3365984.3365986">Collision Handling with Elastic Response Calculation and Zero-Crossing Functions</a>.   Proceedings of the 9th International Workshop on Equation-Based Object-Oriented Modeling Languages and Tools. EOOLT’19. ACM, pp. 57–65.</li></ul></section></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="DynamicDispatch.html">« Dynamic Dispatch</a><a class="docs-footer-nextpage" href="ContactForceLaw.html">Contact Force Law »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.19 on <span class="colophon-date" title="Friday 8 July 2022 05:57">Friday 8 July 2022</span>. Using Julia version 1.7.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
