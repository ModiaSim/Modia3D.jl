<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Contact Detection · Modia3D</title><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.039/juliamono-regular.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.11/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../index.html">Modia3D</a></span></div><form class="docs-search" action="../search.html"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../index.html">Home</a></li><li><span class="tocitem">Tutorial</span><ul><li><a class="tocitem" href="../tutorial/Tutorial.html">Modia3D Tutorial</a></li><li><a class="tocitem" href="../tutorial/GettingStarted.html">Getting Started</a></li><li><a class="tocitem" href="../tutorial/HierarchicalModels.html">Hierarchical models</a></li><li><a class="tocitem" href="../tutorial/RecursiveModels.html">Recursive models</a></li><li><a class="tocitem" href="../tutorial/CollisionHandling.html">Collision Handling</a></li></ul></li><li><span class="tocitem">Components</span><ul><li><a class="tocitem" href="../Components/Object3D.html">Object3D</a></li><li><a class="tocitem" href="../Components/Shapes.html">Shapes</a></li><li><a class="tocitem" href="../Components/Joints.html">Joints</a></li><li><a class="tocitem" href="../Components/Materials.html">Materials</a></li><li><a class="tocitem" href="../Components/GravityField.html">Gravity Field</a></li></ul></li><li><span class="tocitem">Internal</span><ul><li><a class="tocitem" href="Profiling.html">Profiling</a></li><li><a class="tocitem" href="DynamicDispatch.html">Dynamic Dispatch</a></li><li class="is-active"><a class="tocitem" href="ContactDetection.html">Contact Detection</a><ul class="internal"><li><a class="tocitem" href="#Distances"><span>Distances</span></a></li><li><a class="tocitem" href="#Crossing-functions"><span>Crossing functions</span></a></li></ul></li><li><a class="tocitem" href="ContactForceLaw.html">Contact Force Law</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Internal</a></li><li class="is-active"><a href="ContactDetection.html">Contact Detection</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href="ContactDetection.html">Contact Detection</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/ModiaSim/Modia3D.jl/blob/master/docs/src/internal/ContactDetection.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Contact-Detection"><a class="docs-heading-anchor" href="#Contact-Detection">Contact Detection</a><a id="Contact-Detection-1"></a><a class="docs-heading-anchor-permalink" href="#Contact-Detection" title="Permalink"></a></h1><h2 id="Distances"><a class="docs-heading-anchor" href="#Distances">Distances</a><a id="Distances-1"></a><a class="docs-heading-anchor-permalink" href="#Distances" title="Permalink"></a></h2><p>In <code>scene.options.contactDetection</code> (file <code>Modia3D/src/contactDetection/ContactDectionMPR_handler.jl</code>) information about the contact situation is stored in an instance of <a href="ContactDetection.html#Modia3D.Composition.ContactDetectionMPR_handler"><code>Modia3D.ContactDetectionMPR_handler</code></a>.</p><p>The <em>distance</em> between two objects is defined by two variables:</p><p><strong>distanceOrg</strong></p><p>The original distance which is the distance between two objects computed either in the narrow phase or in an approximate way in the broad phase (= distance between Axis Aligned Bounding Boxes). If <code>distanceOrg &lt; 0</code>, then the two objects are penetrating each other.</p><p><strong>distanceWithHysteresis</strong></p><p>The distance reported to the integrator as zero crossing function. If a zero crossing occurs (the value is changing from positive to negative or from negative to positive), an <em>event</em> is triggered and the time instant of the zero crossing is detected up to a certain precision. <code>distanceWithHysteresis</code> is a slightly modified value of <code>distanceOrg</code> in order to cope with numerical inaccuracies and in order to guarantee that this value is not identical to zero when restarting from the event (otherwise the integrator would trigger an error, because it would not be able to detect a zero crossing in the future). At an <em>event instant</em> (including initialization), the following flag is set and keeps its value until the next event (<code>zEps = 1e-8</code>):</p><pre><code class="nohighlight hljs">contact = distanceOrg &lt; -zEps</code></pre><p>Whenever a zero crossing function computation is required by the integrator, the following value is provided to the integrator:</p><pre><code class="nohighlight hljs">distanceWithHysteresis = contact ? distanceOrg : distanceOrg + 2*zEps</code></pre><p>The result is the following:</p><ul><li>At initialization, <code>contact = false</code> if <code>distanceOrg &gt;= -zEps</code>. Therefore, if two objects are touching each other or are slightly penetrating each other (e.g. <code>distanceOrg = -1e-14</code>), then this is not treated as contacting. Otherwise, <code>contact = true</code>.</li></ul><ul><li>During simulation, an event is triggered if<ul><li><code>distanceOrg</code> becomes smaller as <code>-2*zEps</code>, if <code>contact = false</code>.</li><li><code>distanceOrg</code> becomes larger as zero if <code>contact = true</code>.</li></ul></li></ul><p>By this formulation it is guaranteed that <code>distanceWithHysteresis</code> is not identical to zero when starting after initialization or restarting after an event.</p><h2 id="Crossing-functions"><a class="docs-heading-anchor" href="#Crossing-functions">Crossing functions</a><a id="Crossing-functions-1"></a><a class="docs-heading-anchor-permalink" href="#Crossing-functions" title="Permalink"></a></h2><p>Modia3D uses the dictionary <code>contactDict</code> to keep track of the contact situation. Every pair of objects is identified by a unique Integer value called <em>PairID</em> that is used as key in <code>conctactDict</code>. A dictionary value is an instance of <a href="ContactDetection.html#Modia3D.Composition.ContactPair"><code>Modia3D.ContactPair</code></a></p><p>At an event instant, dictionary <code>contactDict</code> is emptied and all object pairs are stored newly in <code>contactDict</code> that have <code>distanceWithHysteresis &lt; 0</code>. Between events, contact forces/torques are only applied on object pairs that are in this dictionary.</p><p>The following functions are used as zero crossing functions:</p><ul><li><span>$z_1(t)$</span>: The maximum <code>distanceWithHysteresis</code> of all object pairs that are in <code>contactDict</code>.</li><li><span>$z_2(t)$</span>: The minimum <code>distanceWithHysteresis</code> of all object pairs that are <strong>not</strong> in <code>contactDict</code>.</li></ul><p>As a result <span>$z_1$</span> monitors if an object pair that has been in contact, looses contact, so <code>distanceWithHysteresis</code> becomes greater than zero, and <span>$z_2$</span> monitors if an object pair that has not been in contact, starts to penetrate each other, so <code>distanceWithHysteresis</code> becomes less than zero,</p><p>Whenever the integrator requires the values of the zero crossing functions, the values of <span>$z_1, z_2$</span> are newly computed. At all other time instants (e.g. communication points), only the distances of the object pairs are computed that are in dictionary <code>contactDict</code>, because these distances are used to compute the contact forces and torques. Distances of object pairs that are not in contact to each other are not computed at these time instant.</p><p>Whenever contact starts for an object pair the normal contact velocity is stored in the value (of type <a href="ContactDetection.html#Modia3D.Composition.ContactPair"><code>Modia3D.ContactPair</code></a>) of the dictionary. When a contact pair was already in contact at an event, it is necessary to utilize the normal contact velocity from the previous event also at the actual event. In order that this is possible, a second dictionary <code>lastContactDict</code> is used: Once <code>contactDict</code> is constructed at an event, a copy is stored in <code>lastContactDict</code>. At the next event, a new <code>contactDict</code> is constructed. Whenever an object pair is included in <code>contactDict</code> that is also present in <code>lastContactDict</code>, then the normal contact velocity stored in <code>lastContactDict</code> is utilized.</p><article class="docstring"><header><a class="docstring-binding" id="Modia3D.Composition.ContactPair" href="#Modia3D.Composition.ContactPair"><code>Modia3D.Composition.ContactPair</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">ContactPair(contactPointA, contactPointB,
    contactNormal, objA, objB,
    distanceWithHysteresis, supportPointsDefined,
    support1A, support2A, support3A,
    support1B, support2B, support3B)</code></pre><p>Generate a new <code>ContactPair</code> object of two objects that have <code>contact = true</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ModiaSim/Modia3D.jl/blob/ba53a0f0cf387ee4d631062b522f292b387fb72d/src/contactDetection/ContactDetectionMPR/ContactDetectionMPR_handler.jl#L29-L37">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="Modia3D.Composition.ContactDetectionMPR_handler" href="#Modia3D.Composition.ContactDetectionMPR_handler"><code>Modia3D.Composition.ContactDetectionMPR_handler</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">handler = ContactDetectionMPR_handler(;tol_rel = 1e-4, niter_max=100, neps=sqrt(eps()))</code></pre><p>Generate a new contact handler for usage of the MPR algorithm The handler instance contains all information about the contact situation.</p><p><strong>Arguments</strong></p><ul><li><code>tol_rel</code>: Relative tolerance to compute the contact point (&gt; 0.0)</li><li><code>niter_max</code>: Maximum number of iterations of the MPR algorithm. If this number is reached,              an error occurs (&gt; 0).</li><li><code>neps</code>: Small number used to check whether a floating number is close to zero (&gt; 0.0).</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ModiaSim/Modia3D.jl/blob/ba53a0f0cf387ee4d631062b522f292b387fb72d/src/contactDetection/ContactDetectionMPR/ContactDetectionMPR_handler.jl#L100-L114">source</a></section></article></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="DynamicDispatch.html">« Dynamic Dispatch</a><a class="docs-footer-nextpage" href="ContactForceLaw.html">Contact Force Law »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.5 on <span class="colophon-date" title="Wednesday 28 July 2021 10:43">Wednesday 28 July 2021</span>. Using Julia version 1.6.0.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
